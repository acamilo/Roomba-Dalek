
<!DOCTYPE html> 
<html> 
<head> 
	<title>Page Title</title> 
	<link rel="stylesheet" href="/static/jquery.mobile-1.3.0.min.css" />
     <script src="/static/jquery-1.8.2.min.js"></script>
     <script src="/static/jquery.mobile-1.3.0.min.js"></script>
       <script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
     <script src="/static/jquery.ui.touch-punch.min.js"></script>
<script src="static/virtualjoystick.js"></script>

	<meta name="viewport" content="width=device-width, initial-scale=1"> 
  <style>
	#container {
width	: 100%;
height	: 200px;
background: black;
overflow	: hidden;
padding	: 0;
margin	: 0;
-webkit-user-select	: none;
-moz-user-select	: none;
}
  </style>

</head> 

<body> 
<div data-role="page" id="drive">
	<div data-role="header">
		<h1>Drive Around</h1>
          <a href="/sounds/" class="ui-btn-right">Soundboard</a>
	</div><!-- /header -->

	<div data-role="content">
    <img id="feed" src="/static/output.jpeg" />	
{% if position == 0 %}



<div id="container"></div>
	<script>
console.log("touchscreen is", VirtualJoystick.touchScreenAvailable() ? "available" : "not available");
var joystick	= new VirtualJoystick({
container	: document.getElementById('container'),
mouseSupport	: true
});

var posx = 0;
var posy = 0;
var oldx = 0;
var oldy = 0;

$( "#container" ).height($(window).height()/4);

setInterval(function(){
                    posx = joystick.deltaX();
                    posy = joystick.deltaY();
			    // update if position changes
			    if (posx != oldx | posy != oldy){ 

				    oldx = posx; oldy = posy;
                    console.log('/drive/'+posx+'/'+posy+'');
				    $.getJSON('/drive/'+posx+'/'+posy+'',null);
			    }
},100);


</script>



<a href="/done" data-role="button">I'm Done!</a> 
{% else %}

        <h1>Sit tight!</h1>
        <p>you are position <em id="position">{{position}}</em> in line!<p>
        <a href="/done" data-role="button">Leave Line</a> 
{% endif %}

	</div><!-- /content -->

</div><!-- /page -->


</body>
{% if position == 0 %}

{% else %}
    <script>
        // Are we driving or waiting?

        // Check to see if our position in the queue changes
        setInterval(function(){
            $.getJSON('/position',function(data){
                if (data.position==0 ){
                    // It's our turn! Lets refresh the page!
                    setTimeout('location.reload()', 2000);
                } else {
                    // Update the counter
                    $("#position").html(data.position);
                }
            })
        },5000);

    </script>
{% endif %}

<script>
setInterval(function(){
d = new Date();
$("#feed").attr("src", "/static/output.jpeg?"+d.getTime());
},200)
</script>
</html>
